<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundLink+ Receiver</title>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-database-compat.js"></script>
    <style>
        body {
            background: url('template.gif') no-repeat center center fixed; /* Replace with your gif URL */
            background-size: cover;
            color: white;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        audio {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <audio id="receivedAudio" controls autoplay></audio>
    
    <script>
        let peerConnection;
        let database;

        const firebaseConfig = {
            // Your Firebase config object here
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        function initializeFirebase() {
            // Initialize Firebase
            const app = firebase.initializeApp(firebaseConfig);
            database = firebase.database(app);
        }

        function initializeWebRTC() {
            initializeFirebase();
            const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
            peerConnection = new RTCPeerConnection(configuration);

            peerConnection.ontrack = event => {
                console.log('Received remote stream:', event.streams[0]);
                document.getElementById('receivedAudio').srcObject = event.streams[0];
            };

            database.ref('offer').on('value', snapshot => {
                const offer = snapshot.val();
                if (offer) {
                    peerConnection.setRemoteDescription(new RTCSessionDescription(JSON.parse(offer)))
                        .then(() => peerConnection.createAnswer())
                        .then(answer => peerConnection.setLocalDescription(answer))
                        .then(() => {
                            database.ref('answer').set(JSON.stringify(peerConnection.localDescription));
                            console.log('Answer created:', peerConnection.localDescription);
                        })
                        .catch(error => {
                            console.error('Error creating answer:', error);
                        });
                }
            });

            database.ref('candidates').on('child_added', snapshot => {
                const candidate = snapshot.val();
                if (candidate) {
                    peerConnection.addIceCandidate(new RTCIceCandidate(JSON.parse(candidate)))
                        .catch(error => {
                            console.error('Error adding ICE candidate:', error);
                        });
                }
            });
        }

        // Initialize WebRTC on page load
        window.onload = initializeWebRTC;
    </script>
</body>
</html>
