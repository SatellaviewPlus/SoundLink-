<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundLink+ Receiver</title>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-database-compat.js"></script>
    <style>
        body {
            background: url('your_background.gif') no-repeat center center fixed; /* Replace with your gif URL */
            background-size: cover;
            color: white;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        audio {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Audio Receiver</h1>
    <audio id="receivedAudio" controls autoplay></audio>
    
    <script>
        let peerConnection;
        let database;

// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAo1x1x1F-zZU5uZDgg24N4gVCL9Xl9QmA",
  authDomain: "soundlink-plus.firebaseapp.com",
  projectId: "soundlink-plus",
  storageBucket: "soundlink-plus.appspot.com",
  messagingSenderId: "930608446048",
  appId: "1:930608446048:web:dc7ae85f5a60d60bc96105",
  measurementId: "G-007FXMK57J"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        function initializeFirebase() {
            // Initialize Firebase
            const app = firebase.initializeApp(firebaseConfig);
            database = firebase.database(app);
        }

        function initializeWebRTC() {
            initializeFirebase();
            const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
            peerConnection = new RTCPeerConnection(configuration);

            // Handle ICE candidate events
            peerConnection.onicecandidate = event => {
                if (event.candidate) {
                    console.log('New ICE candidate:', event.candidate);
                    database.ref('candidates').push(JSON.stringify(event.candidate));
                }
            };

            // Handle track event to receive audio stream
            peerConnection.ontrack = event => {
                const audioElement = document.getElementById('receivedAudio');
                audioElement.srcObject = event.streams[0];
            };

            // Get the offer from Firebase
            database.ref('offer').once('value').then(snapshot => {
                const offer = JSON.parse(snapshot.val());
                peerConnection.setRemoteDescription(new RTCSessionDescription(offer))
                    .then(() => peerConnection.createAnswer())
                    .then(answer => peerConnection.setLocalDescription(answer))
                    .then(() => {
                        database.ref('answer').set(JSON.stringify(peerConnection.localDescription));
                        console.log('Answer created:', peerConnection.localDescription);
                    })
                    .catch(error => {
                        console.error('Error creating answer:', error);
                    });
            });

            // Listen for ICE candidates from the streamer
            database.ref('candidates').on('child_added', snapshot => {
                const candidate = new RTCIceCandidate(JSON.parse(snapshot.val()));
                peerConnection.addIceCandidate(candidate);
            });
        }

        initializeWebRTC();
    </script>
</body>
</html>
